<!DOCTYPE html>
<html>
<head>
    <title>VR Cyber Defense - Ops Room Alive</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <style> @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap'); </style>
</head>
<body>
    <canvas id="matrix-canvas" width="512" height="256" style="display: none;"></canvas>
    
    <script>
        // --- MATRIX CANVAS ANIMATION SCRIPT ---
        (function(){
            const canvas = document.getElementById('matrix-canvas');
            const ctx = canvas.getContext('2d');
            
            let w = canvas.width;
            let h = canvas.height;
            let cols = Math.floor(w / 20) + 1;
            let ypos = Array(cols).fill(0);
    
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, w, h);
    
            function drawMatrix() {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.1)'; // fade effect
                ctx.fillRect(0, 0, w, h);
                
                ctx.fillStyle = '#0f0'; // Green text
                ctx.font = '20px monospace';
                
                ypos.forEach((y, ind) => {
                    // Generate random hex character
                    const text = String.fromCharCode(Math.random() * 128);
                    const x = ind * 20;
                    ctx.fillText(text, x, y);
                    
                    // Reset condition or move down
                    if (y > h && Math.random() > 0.975) ypos[ind] = 0;
                    else ypos[ind] = y + 20;
                });
                requestAnimationFrame(drawMatrix);
            }
            drawMatrix();
        })();
    </script>

    <script>
        // --- GAME LOGIC (UNCHANGED) ---
        const gameData = [
            {
                level: 1,
                name: "MITM ATTACK",
                alert: "ALERT: ARP SPOOFING DETECTED",
                logs: "[SYS]: Gateway MAC address mismatch.\n[NET]: 192.168.1.5 is broadcasting fake packets.\n[WARN]: Man-in-the-Middle active.",
                options: [
                    { cmd: "sudo flush_dns", label: "Flush DNS", correct: false },
                    { cmd: "arp -s 192.168.1.1 static", label: "Static ARP Entry", correct: true }, 
                    { cmd: "ping 8.8.8.8", label: "Ping Ext IP", correct: false }
                ]
            },
            {
                level: 2,
                name: "DDOS FLOOD",
                alert: "CRITICAL: UDP FLOOD INBOUND",
                logs: "[FIREWALL]: Traffic spike > 50Gbps.\n[CPU]: Server load critical (99%).\n[SRC]: Botnet signature identified.",
                options: [
                    { cmd: "iptables -A INPUT -p udp -j DROP", label: "Filter UDP", correct: true },
                    { cmd: "service network restart", label: "Restart Network", correct: false },
                    { cmd: "reboot", label: "Reboot Server", correct: false }
                ]
            },
            {
                level: 3,
                name: "RANSOMWARE",
                alert: "BREACH: ENCRYPTION STARTED",
                logs: "[IDS]: 'WannaCry' signature detected.\n[DISK]: Unauthorized write operations.\n[PROC]: Kill signal sent to PID 8821.",
                options: [
                    { cmd: "kill -9 8821", label: "Terminate PID 8821", correct: true },
                    { cmd: "cp -r / /backup", label: "Backup Files", correct: false },
                    { cmd: "format c:", label: "Wipe Drives", correct: false }
                ]
            }
        ];

        let currentLevel = 0;
        let timeLeft = 240; 
        
        AFRAME.registerComponent('soc-manager', {
            init: function () {
                this.loadLevel(0);
                this.startTimer();
            },

            startTimer: function() {
                const timerEl = document.querySelector('#timer-display');
                setInterval(() => {
                    if(timeLeft > 0) {
                        timeLeft--;
                        let m = Math.floor(timeLeft / 60);
                        let s = timeLeft % 60;
                        timerEl.setAttribute('value', `TIME REMAINING: 0${m}:${s < 10 ? '0'+s : s}`);
                        if(timeLeft < 60) timerEl.setAttribute('color', 'red');
                    } else {
                        this.triggerGlitch("TIMEOUT");
                    }
                }, 1000);
            },

            loadLevel: function(idx) {
                if (idx >= gameData.length) {
                    this.missionSuccess();
                    return;
                }
                const data = gameData[idx];
                document.querySelector('#alert-title').setAttribute('value', data.alert);
                const roomLight = document.querySelector('#alert-light');
                roomLight.setAttribute('intensity', '1.2');
                roomLight.setAttribute('animation', 'property: intensity; from: 0.8; to: 1.5; dur: 800; dir: alternate; loop: true');
                document.querySelector('#log-display').setAttribute('value', data.logs);
                const buttons = document.querySelectorAll('.cmd-btn');
                const labels = document.querySelectorAll('.cmd-label');
                data.options.forEach((opt, i) => {
                    labels[i].setAttribute('value', `> ${opt.label}`);
                    buttons[i].setAttribute('data-correct', opt.correct);
                    buttons[i].setAttribute('material', 'color: #333; opacity: 0.6; metalness: 0.8; roughness: 0.2'); 
                });
            },

            verifyCommand: function(btnElement) {
                const isCorrect = btnElement.getAttribute('data-correct') === 'true';
                const output = document.querySelector('#terminal-output');
                output.setAttribute('value', "EXECUTING...");
                if (isCorrect) {
                    output.setAttribute('color', '#00ff00');
                    output.setAttribute('value', "ACCESS GRANTED. PATCHING...");
                    setTimeout(() => {
                        currentLevel++;
                        this.loadLevel(currentLevel);
                        output.setAttribute('value', "AWAITING INPUT...");
                    }, 2000);
                } else {
                    this.triggerGlitch();
                }
            },

            triggerGlitch: function() {
                const cam = document.querySelector('#rig');
                const terminal = document.querySelector('#terminal-output');
                cam.setAttribute('animation', 'property: position; from: 0 0 0; to: 0.1 0.1 0; dur: 50; loop: 10; dir: alternate');
                terminal.setAttribute('value', "ERROR: KERNEL PANIC");
                terminal.setAttribute('color', 'red');
                setTimeout(() => {
                    cam.removeAttribute('animation');
                    cam.setAttribute('position', '0 0 0');
                    terminal.setAttribute('value', "REBOOTING SHELL...");
                }, 2000);
            },

            missionSuccess: function() {
                document.querySelector('#alert-title').setAttribute('value', "SYSTEM SECURE");
                document.querySelector('#alert-panel').setAttribute('material', 'color: #004400; opacity: 0.4');
                const roomLight = document.querySelector('#alert-light');
                roomLight.setAttribute('color', '#00aaff'); 
                roomLight.removeAttribute('animation');
                roomLight.setAttribute('intensity', '0.6');
                document.querySelector('#log-display').setAttribute('value', "ALL THREATS NEUTRALIZED.");
                document.querySelector('#terminal-output').setAttribute('value', "MISSION COMPLETE");
            }
        });

        function clickBtn(index) {
            const btns = document.querySelectorAll('.cmd-btn');
            document.querySelector('a-scene').components['soc-manager'].verifyCommand(btns[index]);
        }
    </script>

    <a-scene soc-manager background="color: #222" fog="type: exponential; color: #222; density: 0.01">
        
        <a-assets>
            <img id="matrix-tex" src="#matrix-canvas">
            
            <img id="concrete-tex" src="https://cdn.aframe.io/360-image-gallery-boilerplate/img/cubes.jpg">
            <a-mixin id="server-rack" geometry="primitive: box; height: 2.5; width: 0.8; depth: 0.8" 
                     material="color: #333; roughness: 0.5; metalness: 0.7"></a-mixin>
            <a-mixin id="blinking-light" geometry="primitive: plane; height: 0.02; width: 0.02" 
                     material="shader: flat; color: #00ff00"
                     animation="property: material.opacity; from: 1; to: 0; dur: 200; loop: true; dir: alternate"></a-mixin>
            <a-mixin id="glass-panel" material="opacity: 0.3; transparent: true; side: double; metalness: 0.9; roughness: 0.1"></a-mixin>

            <a-mixin id="person-body" geometry="primitive: cylinder; height: 0.8; radius: 0.25" material="color: #222"></a-mixin>
            <a-mixin id="person-head" geometry="primitive: sphere; radius: 0.18" material="color: #333"></a-mixin>
        </a-assets>

        <a-entity id="rig" position="0 0 0">
            <a-camera look-controls wasd-controls>
                <a-cursor color="cyan" fuse="true" fuse-timeout="1000"
                          animation__click="property: scale; startEvents: click; from: 0.1 0.1 0.1; to: 1 1 1; dur: 150">
                </a-cursor>
            </a-camera>
        </a-entity>

        <a-light type="ambient" intensity="0.7" color="#ffffff"></a-light>
        <a-light id="alert-light" type="point" position="0 2.5 0" intensity="0.8" color="#ff0000" distance="20" castShadow="true"></a-light>
        <a-light type="spot" position="0 2 -1" target="#desk-surface" penumbra="0.3" angle="50" intensity="1.0" color="#ffffff"></a-light>

        <a-plane rotation="-90 0 0" width="15" height="15" src="#concrete-tex" repeat="4 4" metalness="0.1" roughness="0.8" color="#666"></a-plane>
        <a-plane rotation="90 0 0" position="0 3 0" width="15" height="15" color="#333"></a-plane>
        <a-box position="0 1.5 -6" width="15" height="3" depth="0.1" src="#concrete-tex" repeat="3 1" color="#777"></a-box> <a-box position="-5 1.5 0" width="0.1" height="3" depth="15" src="#concrete-tex" repeat="3 1" color="#777"></a-box> 
        <a-box position="5 1.5 0" width="0.1" height="3" depth="15" src="#concrete-tex" repeat="3 1" color="#777"></a-box> 

        <a-box id="desk-surface" position="0 0.8 -1.2" width="2.8" height="0.1" depth="1.2" color="#444" metalness="0.5" roughness="0.3"></a-box>
        <a-box position="0 1.2 -1.6" width="1.2" height="0.7" depth="0.05" color="#222"></a-box>
        <a-box position="-1.3 1.2 -1.4" rotation="0 25 0" width="0.8" height="0.6" depth="0.05" color="#222"></a-box>
        <a-box position="1.3 1.2 -1.4" rotation="0 -25 0" width="0.8" height="0.6" depth="0.05" color="#222"></a-box>
        <a-cylinder position="0.9 0.9 -1.0" radius="0.06" height="0.2" color="#ff9900" metalness="0.8"></a-cylinder>

        <a-entity mixin="server-rack" position="-3.5 1.25 -2.5"></a-entity>
        <a-entity mixin="blinking-light" position="-3.1 2 -2.5" rotation="0 90 0"></a-entity>
        <a-entity mixin="server-rack" position="3.5 1.25 -2.5"></a-entity>
        <a-entity mixin="blinking-light" position="3.1 1.8 -2.5" rotation="0 -90 0" color="red"></a-entity>

        <a-entity position="-4 0 -5" rotation="0 30 0">
            <a-box width="2" height="0.8" depth="1" color="#333" position="0 0.4 0"></a-box>
            <a-plane width="1.8" height="1" position="0 1.4 -0.4" rotation="-10 0 0" material="src: #matrix-tex; flatShading: true"></a-plane>
            <a-light type="point" color="#0f0" intensity="0.5" distance="3" position="0 1.5 -0.5"></a-light>
            <a-entity position="0 0.9 0.5">
                <a-entity mixin="person-body"></a-entity>
                <a-entity mixin="person-head" position="0 0.6 0"></a-entity>
                <a-box color="#222" width="0.15" height="0.1" depth="0.5" position="-0.3 0.2 -0.3" rotation="15 0 0"></a-box>
                <a-box color="#222" width="0.15" height="0.1" depth="0.5" position="0.3 0.2 -0.3" rotation="15 0 0"></a-box>
            </a-entity>
        </a-entity>

        <a-entity position="4 0 -5" rotation="0 -30 0">
             <a-box width="2" height="0.8" depth="1" color="#333" position="0 0.4 0"></a-box>
            <a-plane width="1.8" height="1" position="0 1.4 -0.4" rotation="-10 0 0" material="src: #matrix-tex; flatShading: true"></a-plane>
             <a-light type="point" color="#0f0" intensity="0.5" distance="3" position="0 1.5 -0.5"></a-light>
            <a-entity position="0 0.9 0.5">
                <a-entity mixin="person-body"></a-entity>
                <a-entity mixin="person-head" position="0 0.6 0"></a-entity>
                 <a-box color="#222" width="0.15" height="0.1" depth="0.5" position="-0.3 0.2 -0.3" rotation="15 0 0"></a-box>
                 <a-box color="#222" width="0.15" height="0.1" depth="0.5" position="0.3 0.2 -0.3" rotation="15 0 0"></a-box>
            </a-entity>
        </a-entity>


        <a-entity position="0 1.6 -1.3">
            <a-entity position="-1.8 0 0.5" rotation="0 25 0">
                <a-plane id="alert-panel" width="1.4" height="1" mixin="glass-panel" color="#440000">
                     <a-text value="THREAT INTELLIGENCE" position="0 0.4 0.01" align="center" color="#ff8888" width="3"></a-text>
                     <a-text id="alert-title" value="SCANNING..." position="0 0 0.01" align="center" width="2.5" color="red" font="sourcecodepro"></a-text>
                </a-plane>
            </a-entity>
            <a-entity position="0 -0.2 0">
                <a-text id="timer-display" value="00:00" position="0 0.6 0.01" align="center" color="yellow" width="4"></a-text>
                <a-plane mixin="glass-panel" color="#001133" height="0.3" width="1.6" position="0 0.25 0">
                    <a-text id="terminal-output" value="root@darkweb:~#" color="#00ff00" align="left" position="-0.75 0 0.01" width="2"></a-text>
                </a-plane>
                <a-entity position="0 -0.1 0.05">
                    <a-box class="cmd-btn" position="0 0.2 0" depth="0.02" height="0.12" width="1.4" 
                           material="color: #444; opacity: 0.6; transparent: true" onclick="clickBtn(0)">
                        <a-text class="cmd-label" value="Option A" align="center" z-offset="0.03" color="white"></a-text>
                    </a-box>
                    <a-box class="cmd-btn" position="0 0 0" depth="0.02" height="0.12" width="1.4" 
                           material="color: #444; opacity: 0.6; transparent: true" onclick="clickBtn(1)">
                        <a-text class="cmd-label" value="Option B" align="center" z-offset="0.03" color="white"></a-text>
                    </a-box>
                    <a-box class="cmd-btn" position="0 -0.2 0" depth="0.02" height="0.12" width="1.4" 
                           material="color: #444; opacity: 0.6; transparent: true" onclick="clickBtn(2)">
                        <a-text class="cmd-label" value="Option C" align="center" z-offset="0.03" color="white"></a-text>
                    </a-box>
                </a-entity>
            </a-entity>
            <a-entity position="1.8 0 0.5" rotation="0 -25 0">
                <a-plane width="1.4" height="1" mixin="glass-panel" color="#000044">
                    <a-text value="PACKET SNIFFER" position="0 0.4 0.01" align="center" color="#8888ff" width="3"></a-text>
                    <a-text id="log-display" value="..." position="-0.65 0.1 0.01" align="left" width="1.3" color="#aaaaff" font="sourcecodepro"></a-text>
                </a-plane>
            </a-entity>
        </a-entity>

    </a-scene>
</body>
</html>
